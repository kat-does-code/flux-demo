---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: mysqldb
  namespace: flux-system
spec:
  chart:
    spec:
      chart: mysql
      reconcileStrategy: ChartVersion
      sourceRef:
        kind: HelmRepository
        name: bitnamicharts
  interval: 1m0s
  values:
    auth:
      username: myuser
      password: mypassword
    initdbScripts: 
      import.sh: |
        #!/bin/sh
        cd /data/test_db/
        mysql -u root -png75fJPTnu my_database < employees_partitioned.sql
        mysql -t < test_employees_md5.sql
    primary:
      persistence:
        enabled: false
      extraVolumeMounts:
          - name:  mysql-pv-storage
            mountPath: "/data/"
      extraVolumes:
        - name: mysql-pv-storage
          persistentVolumeClaim:
            claimName: mysql-pv-claim  